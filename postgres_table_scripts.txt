drop table if exists products;

create table if not exists products
(
    id          integer generated by default as identity (maxvalue 10000000)
        constraint products_pk
            primary key,
    name        text
        constraint products_pk2
            unique,
    description text,
    price       integer,
    quantity    integer
);

--alter table products
    --owner to postgres;

drop table if exists users;
create table if not exists users
(
    username   text not null
        constraint users_pk
            primary key,
    password   text,
    first_name text,
    last_name  text
);

--alter table users
    --owner to postgres;

drop table if exists reviews;
create table if not exists reviews
(
    reviews_description text,
    reviews_rating      double precision,
    date                date,
    "user"              text    not null
        constraint reviews_users_username_fk
            references users,
    product_id          integer not null
        constraint product
            references products,
    constraint reviews_pk
        primary key ("user", product_id)
);

--alter table reviews
    --owner to postgres;

drop table if exists orders;
create table if not exists orders
(
    id     integer generated always as identity (maxvalue 10000000)
        constraint orders_pk
            primary key,
    "user" text
        constraint orders_users_username_fk
            references users,
    date   date
);

--alter table orders
   -- owner to postgres;

drop table if exists items;
create table if not exists items
(
    order_id         integer not null
        constraint items_orders_id_fk
            references orders,
    product_quantity integer,
    product_id       integer not null
        constraint items_products_id_fk
            references products,
    constraint items_pk
        primary key (order_id, product_id)
);

--alter table items
  --  owner to postgres;

commit;
